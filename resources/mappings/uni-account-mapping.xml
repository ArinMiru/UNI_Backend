<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="uni-account-mapping">

  
  <select id="selectCheckId" resultType="hashMap" parameterType="hashMap">
    SELECT 	IF(PASS = #{LOGIN_PASS},'00','01') AS RSLT_CD 
    FROM 	MEMB_BAS
	WHERE 	MEMB_ID = #{LOGIN_ID}
  </select>
  
  <select id="selectMembInfo" resultType="HashMap" parameterType="HashMap">
    SELECT 
		A.MEMB_ID AS LOGIN_ID
		,A.MEMB_NM
		,A.MEMB_SC_CD
		,A.MEMB_DEP_CD
		,A.MEMB_NUM
		,B.CODE_VAL AS MEMB_SC_NM
		,C.CODE_VAL AS MEMB_DEP_NM
		,A.TIT_CD
		,D.CODE_VAL AS TIT_NM
		,A.NICK_NM
		,A.MEMB_GRA
		,A.MEMB_EM
		,A.PROF_IMG_PATH
		,IF(E.CERT_DIV_CD = '01','Y','N') AS COLL_CERT_IND
	FROM MEMB_BAS A 
	LEFT JOIN CD_BAS B ON B.CODE_TYPE = 'MEMB_SC_CD' AND B.CODE = A.MEMB_SC_CD
	LEFT JOIN CD_BAS C ON C.CODE_TYPE = 'MEMB_DEP_CD' AND C.CODE = A.MEMB_DEP_CD
	LEFT JOIN CD_BAS D ON D.CODE_TYPE = 'TIT_CD' AND D.CODE = A.TIT_CD
	LEFT JOIN CERT_MEMB_HIST E ON E.MEMB_ID = A.MEMB_ID AND E.CERT_DIV_CD = '01'
	WHERE A.MEMB_ID = #{LOGIN_ID}
  </select>
  
  <select id="selectOpenBubInfo" resultType="HashMap" parameterType="HashMap">
    SELECT 
		*
	FROM (
		SELECT
			ROW_NUMBER() OVER() AS R_NUM
			,MEMB_ID
			,CRE_SEQ	
			,TIT
			,CONT
			,LIKE_CNT
			,DATE_FORMAT(CRE_DAT,'%Y-%m-%d %H:%i') AS CRE_DAT
		FROM OPEN_BUB_BAS
		WHERE MEMB_SC_CD = #{MEMB_SC_CD}
		AND MEMB_DEP_CD = #{MEMB_DEP_CD}
		ORDER BY CRE_DAT DESC
 	) A
 	<![CDATA[
	WHERE A.R_NUM >= 1 
	AND A.R_NUM <= 10
	]]>
  </select>
  
  <select id="selectOpenImgInfo" resultType="HashMap" parameterType="HashMap">
    SELECT 
		B.FILE_PATH
		,B.IMG_SEQ
	FROM OPEN_BUB_BAS A , OPEN_BUB_IMG_HIST B
	WHERE 	B.CRE_SEQ = A.CRE_SEQ
	AND 	A.MEMB_SC_CD = #{MEMB_SC_CD}
	AND 	A.MEMB_DEP_CD = #{MEMB_DEP_CD}
	AND 	A.CRE_SEQ = #{CRE_SEQ}
  </select>
  
  <select id="insertMembInfo" resultType="HashMap" parameterType="HashMap">
  <!-- 23.05.10 회원가입 (김도원) -->
  	INSERT INTO MEMB_BAS (MEMB_ID,PASS,MEMB_NM) VALUES ('userId','userPasswrd','userName');
  </select>
  
  <update id="updateMembuniCertUpd" parameterType="Hashmap"> 
  <!-- 23.05.10 대학인증 회원수정 (김도원) -->
  	UPDATE MEMB_BAS set
 	MEMB_ID = #{userId}
	,MEMB_SC_CD = #{userSccd}
	,MEMB_DEP_CD = #{userDepcd}
	,MEMB_NUM = #{userNum}
	,MEMB_EM = #{userEm}
	WHERE MEMB_ID = #{userId};
  </update>
  
  <update id="updateMembPassUpd" parameterType="Hashmap">
  <!-- 23.05.10 비밀번호 변경 (김도원) -->
  	UPDATE MEMB_BAS set
	PASS = #{userPass}
	WHERE MEMB_ID = #{userId};
  </update>
  
  <update id="updateMembNicUpd" parameterType="Hashmap">
  	<!-- 23.05.10 닉네임 변경 (김도원) -->
  	UPDATE MEMB_BAS set
 	NICK_NM = #{userNic}
	WHERE MEMB_ID = #{userId};
  </update>
  
  <update id="updateMembAlmInfoUpd" parameterType="Hashmap">
  	<!-- 23.05.10 알림정보수정 (김도원) -->
  	UPDATE USE_NOTICE_BAS set
	APP_NOTICE_YN = #{depNotice_YN}
	DEP_NOTICE_YN = #{appNotice_YN}
	WHERE MEMB_ID = #{userId};	
  </update>
  
  <update id="updateMembInfoUpd" parameterType="Hashmap">
  	<!-- 23.05.10 프로파일 이미지변경 (김도원) -->
  	<!-- 주의사항 이미지 파일명을 회원 id 로 변경하여 저장한다.(확장자는 유지) -->
	UPDATE MEMB_BAS set
 	PROF_IMG_PATH = #{prof_img_path}
	WHERE MEMB_ID = #{userId};
  </update>  
  
  <select id="selectMembIdchk" resultType="HashMap" parameterType="HashMap">
  	<!-- 23.05.10 회원 ID 중복 체크 (김도원) -->
  	SELECT 'Y' FROM dual
   	WHERE EXISTS (
   	SELECT MEMB_ID FROM MEMB_BAS 
   	WHERE MEMB_ID = #{userId});
  </select>
  
  <select id="selectMembNicchk" resultType="HashMap" parameterType="HashMap">
  	<!-- 23.05.10 닉네임 중복 체크 (김도원) -->
	SELECT 'Y' FROM dual
   	WHERE EXISTS (
   	SELECT MEMB_ID FROM MEMB_BAS 
   	WHERE NICK_NM = #{userNic});
  </select>  
  
</mapper>